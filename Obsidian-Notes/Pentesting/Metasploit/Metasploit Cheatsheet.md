# Metasploit
---
## Navigation
- **[[#Basic commands]]**
- **[[#Information gathering]]**
	- [[#Port scanning]]
	- [[#Backup files from websites]]
	- [[#Directory listing test]]
	- [[#SSL testing]]
	- [[#SSH kippo detection]]
	- [[#Domain Name System]]
	- [[#Remote Desktop protocol]]
	- [[#Password Sniffing]]
	- [[#Shodan qeuries]] 
- **[[#Vulnerability Hunting]]**
	- [[#Managing the database]] 
	- [[#Importing scans]]
	- [[#Backing up the database]]
	- [[#Nmap with metasploit]]
	- [[#Nessus]]
	- [[#msf utilities]]

---
# Basic commands
 - **Version**: Display version.
 - **Connect <IP:PORT>**: Works like Netcat.
 - **Help**: Display help :).
 - **Route**: Manage routes.
 - **Save**: Save the session configuration for later use.
 - **Sessions**: Manage sessions.
 - **Spool**: Saves errors in a file for later debugging.
 - **Show**: Display available modules.
 - **Info**: Display details about a specific module.
 - **irb**: Invokes the interactive ruby platform,which can be used for creating and invoking custom scripts during ***post-exploitation.*** phase
 - **Makerc**: Write out te entire command history for a particular session to a user-defined output file.
 - **Search**: To search for modules etc..
 - **Get**: Used to retrieve the value contained in a particular local variable like : *RHOSTS*.
 - **Getg**: Similar to *get*,but used to get the value for a *global variable*.
 - **Set**&**unset**: For setting and unsetting variables.
 - **Setg**&**unsetg**: For setting and unsetting global variables.

# Information gathering
## Port scanning
```txt
auxiliary/scanner/portscan/tcp
auxiliary/scanner/discovery/udp_sweep
```
## Backup files from websites
Sometimes, developers and application administrators forget to remove backup files from the web server
```txt
auxiliary/scanner/http/backup_file
```
## Directory listing test
Quite often, the web server is misconfigured to display the list of files contained in the root directory.
```txt
auxiliary/scanner/http/dir_listing
```
## SSL testing
Tests for weak cryptography and misconfigurations.
```txt
auxiliary/scanner/http/ssl
```
Tests for heartbleed vuln.
```txt
auxiliary/scanner/ssl/openssl_heartbleeds
```

## SSH kippo detection
Kippo is an SSH-based honeypot that is specially designed to lure and trap potential attackers.
```txt
auxiliary/scanner/ssh/detect_kippo
```
## Domain Name System
```txt
auxiliary/gather/dns_info
```
## Remote Desktop protocol
Test for `MS12-020` vulnerability.
```txt
auxiliary/scanner/rdp/ms12_020
```
## Password Sniffing
iT listens on the network interface and looks for passwords sent over various protocols, such as `FTP`, `IMAP`,`POP3`, and `SMB`.
```txt
auxiliary/sniffer/psnuffle
```
## Shodan qeuries
```txt
auxiliary/gather/shodan_search
```
# Vulnerability Hunting
## Managing the database
```bash
service postgresql start
```
Initiate the PostgreSQL database service
```bash
msfdbinit
db_status
```
## Managing workspaces
- **Workspace:** Lists all previously created workspaces.
- **Workspace -h :** This lists help for Workspace.
- **Workspace -a \<NAME\>:** This creates anew workspace.
- **Workspace -d \<NAME\>:** This deletes workspace.
- **Workspace \<NAME\>:** This switches to the specified workspace.
## Importing scans
Importing scans.
```bash
db_import <PathToFile>
db_import /AbuQasem/Desktop/Nmapscan.xml
```
Lists all the hosts found during scans and imports.
```bash
hosts
#Show columns and search filter by linux
hosts -C address,os_flavor -S Linux
```
Lists the services from an imported file and the DB.
```bash
services
services -h
```
## Backing up the database
Exports all data within the database to an external XML file.
```bash
db_export -f xml <PathToSave>
```
 ## Nmap with metasploit
 ```bash
 #All default nmap options work here
 db_nmap 
 ```
 ## Nessus
 - Perform a Nessus scan on the target system, save the report, and then import it  `db_import`.
 - Load, initiate, and trigger a Nessus scan on the target system directly through msfconsole.
```bash
#Make sure that nessus daemon is running.
sudo service nessus start
#Then load nessus
load nessus
#We need to select which policy we will use to scan our target system
nessus_policy_list
nessus_scan_new <Policy_UUID>
nessus_scan_launch <Scan ID>
#Get the report after it finishes
nessus_report_vulns <Scan ID>
```
## msf utilities
Path  to the tools -> `/usr/share/metasploit-framework/tools`
- **msf-exe2vbs:** Convert an executable payload into `VBScript format`.
- **msf-exe2vba:** Convert an executable payload into `VBA format`.
- **msf-pdf2xdp:** At times, the PDF file gets flagged by the security software. It is possible to encode the malicious PDF in XDP format in order to evade the antivirus and other security software.
- **msf-msf_irb:** Built-in Ruby shell that can be used for post-exploitation capabilities (Can be invoked seperately).
- **msf-pattern_create:** Related to exploit-dev.
- **msf-virustotal:** Accepts file samples as input and provides analysis on how many different antivirus engines were able to detect the file sample for the presence of malware.
- **msf-makeiplist:**  Make a range of IP's to scan.
```txt
#Create a file with a pattern like this:
192.168.1.0-150
#Then
msf-makeiplist -i <FILE>
#Output
192.168.1.1
192.168.1.2
192.168.1.3
.
.
etc..
```