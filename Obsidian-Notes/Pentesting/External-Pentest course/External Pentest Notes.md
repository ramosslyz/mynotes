# Starting the job
---
### Things to ask the client before starting the job:
-  **What is the scope of this engagement?**
- **What are the emergency Lines of communication?**

- **What is the time scheduling?**
- **what is the goal ?**
---
## ***Methodology***:
- Run an automated scanner like ***Nessus***,***OpenVAS*** or any other preffered tool to scan the webapp and do a portscan while you are working.

- Search for employees credentials to ***password spray*** login portals and other services.
- Search for outdated ***Services***,***CMS*** ..etc because they may have a public exploit which can lead to information disclosure or even a ***Remote Code Execution***.
- Search for common misconfigurations.
- After getting into the internal network,do the PrivESC job to get to the highest privilige possible.
- Write the report
---
## ***Note***:
- Keep in touch with the client and keep him updated.

- If you are going to do something that might impact the Availablity of their services,it's highly recommended to ask them before taking any action.
- [**TCM Pentesting Check List**](https://github.com/zAbuQasem/External-Pentest-Checklist)
---
# Finding Emails and Creds:
---

## *Methodology*:
#### Use the following tool and websites to hunt for emails , passwords ..etc
	
- [**BreachParse**](https://github.com/hmaverickadams/breach-parse): is a tool that find employees emails and passwords from an old breach by just giving it a Specific domain.

- [**Phonebook**](https://phonebook.cz/): is a website used to find emails ,domains,URL's  from a 34 *billion* records.

- [**Dehashed**](https://www.dehashed.com/): is a website that have a huge record of leaked information that helps for further investigation after getting the emails from **BreachParse** or **Phonebook** ..etc.

---
## *Notes*:
- Always keep an eye no the Email & Password policy used.
- Always think with the logical brain.
- LinkedIn and social websites can be a good place to find employee's email address.
- Identify emails by observing errors from login portals.
---
# Password Spraying
---

## ***Attacking office365 portal***
[**TrevorSpray**](https://github.com/blacklanternsecurity/TREVORspray) : is the best tool (till now) to spray O365 with alot of good options!

- When using the tool observe the errors, then higher/lower the delay to make sure everything is ok.

- Every error other than   `Invalid [snip..]` may be a valid login so check it manually.
- it's recommended to spawn aws instances to proxy through to avoid getting your ip blocked.
-- Recommended Command : 
`./trevorspray.py -e emails.txt -p <PASSWORD> -d 1 -n -s <instance>@<ip> <instance>@<ip>`
---
## ***Attacking Outlook web app***
- Using metasploit Auxilary ->  `scanner/http/owa_login`
-- The module advantage is that it detects if the user name is valid.
 -- It supplies us the internal domain after a valid login.
---
## ***Other Login portals***
- Using Burpsuite
--Bypass rate limit or other general security measures by using tricks showed in [**Portswigger Academy**](https://portswigger.net/web-security/authentication)
---
## ***Bypassing MFA***
- [**MFAsweep**](https://github.com/dafthack/MFASweep): MFASweep is a PowerShell script that attempts to log in to various Microsoft services using a provided set of credentials and will attempt to identify if MFA is enabled.
---
## ***Notes***:
- Try Default creds if available.
- Think logically how to tweak passwords.
- Street address, company name, footballl team ..etc can be good variations to try.
- Be aware of the 'Lock out policy' to stay away from locking an admin account or so.
- Spraying VPN portals isn't a good idea because they offen have a good detection mechanism.
---
# Attacking strategy
---
## ***Valid logins***
- See if the account have high privileges that can let you in to their internal network.
- Use the those valid creds to login into other services like [**Azure**](https://m.facebook.com/story.php?story_fbid=3315102725201275&id=100001047404110) (assuming  they are running on an active directory ) ..etc
---
## ***Common Findings***:
- **Insufficient Authentication Controls [High]**
-- Misconfigured MFA
-- Not implementing MFA
- **Weak Password Policy [high]**
-- [Mitigation](https://docs.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/password-must-meet-complexity-requirements)

-  **Insufficient Patching [Medium ~ Critical]**
-- Outdated services or applications that may have a public exploit than can lead to a compromise.
-- For example an outdated **CMS **or **PHP** or a **Tomcat apache server** ..etc
- **Unexpected Perimeter Services [Meduim  ~ High]**
-- RDP , TELNET , REDIS, MEMCACHED ..etc
- **Default Credentials [Meduim ~ Critical]**
-- Mostly found when pentesting internally but this doesn't mean it's not present in the wild.
- **Undetected Malicious Activity [High]**
 -- Not detecting your malicious activity during the engagement.
 -- If they detected something , include that in the report. 
- **Insufficient Encryption [Low]**
-- Can be detected by **Nessus**
-- Risk --> ***MITM attack***
- **Information Disclosure [Low]**
-- From errors and HTTP response headers or login portals or breaking the search bar ..etc
- **Default web pages [Low]**
- **Insufficient Traffic Blocking [Low]**
-- Not blocking traffic from countries that they are not dealing with can make them a target for active hackers.
 
 - **Finding Credentials from a previous breach [Low - High]**
 -- [**Have i been pwned**](https://haveibeenpwned.com/) 
 ---
# Report writing
---
## ***Templates***
- [**TCM SECURITY**](https://github.com/hmaverickadams/TCM-Security-Sample-Pentest-Report)
 - [**Public Reports**](https://github.com/juliocesarfort/public-pentesting-reports)

- [**PwnDoc**](https://github.com/pwndoc/pwndoc) --> interesting  tool

- [**Write Hat**](https://github.com/blacklanternsecurity/writehat) --> interesting tool