# XPath injection
---
XPath is a language that has been designed and developed primarily to address parts of an XML document. In XPath injection testing, we test if it is possible to inject XPath syntax into a request interpreted by the application, allowing an attacker to execute user-controlled XPath queries. When successfully exploited, this vulnerability may allow an attacker to bypass authentication mechanisms or access information without proper authorization.
**XML databases use XPath as their standard query language.**
XPath injection attacks can be much more adaptable and ubiquitous. Another advantage of an XPath injection attack is that, unlike SQL, no ACLs are enforced, as our **query can access every part of the XML document**.

## Testing
Let’s assume that our database is represented by the following XML file:

```xml
<?xml version="1.0" encoding="ISO-8859-1"?>
<users>
    <user>
        <username>qasem</username>
        <password>!c3</password>
        <account>admin</account>
    </user>
    <user>
        <username>oamr</username>
        <password>w1s3c</password>
        <account>guest</account>
    </user>
    <user>
        <username>khaled</username>
        <password>Un6R34kb!e</password>
        <account>guest</account>
    </user>
</users>
```
An XPath query that returns the account whose username is `qasem` and the password is `!c3` would be the following:
```txt
string(//user[username/text()='qasem' and password/text()='!c3']/account/text())
```
The XPath injection will be (if no input sanitization)
```txt
Username: ' or '1' = '1
Password: ' or '1' = '1
```

```txt
string(//user[username/text()='' or '1' = '1' and password/text()='' or '1' = '1']/account/text())
```

# Blind XPath injection
Blind XPath Injection attacks can be used to extract data from an application that embeds user supplied data in an unsafe way.
This attack is used when no knowledge about the structure of the XML document, or perhaps error message are suppressed, and is only **able to pull once piece of information at a time by asking true/false questions(booleanized queries)**.
## Boolenization
Using a `string-length(S)` function, where S is a string, the attacker may find out the length of this string. With the appropriate number of `substring(S,N,1)` function iterations, where *S is a previously mentioned string*, N is a start character*, *and *“1” is a next character counting from N character*, the attacker is able to enumerate the whole string.

> exploitation: https://owasp.org/www-community/attacks/Blind_XPath_Injection 
### Whitepapers

-   [Amit Klein: “Blind XPath Injection”](http://dl.packetstormsecurity.net/papers/bypass/Blind_XPath_Injection_20040518.pdf)
-   [XPath 1.0 specifications](https://www.w3.org/TR/1999/REC-xpath-19991116/)